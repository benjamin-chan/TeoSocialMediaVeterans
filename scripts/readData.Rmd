# Read data


## Facebook ad metrics data

```{r}
df1 <-
  "C:/Users/chanb/Box Sync/Facebook pilot - Statisticians/Lifetime ad performance by ad-day 6.8.17.csv" %>% 
  read.csv(stringsAsFactors = FALSE) %>% 
  filter(Ad != "All")
oldnames <- names(df1)
newnames <- c("date",
              "ad",
              "reach",
              "cost",
              "impressions",
              "cpm",
              "linkClicks",
              "ctr",
              "cpc",
              "uniqueLinkClicks",
              "uniqueCTR",
              "costPerUniqueLinkClick",
              "clicksAll",
              "ctrAll",
              "cpcAll",
              "uniqueClicksAll",
              "uniqueCTRAll",
              "costPerUniqueClickAll",
              "reactions",
              "comments",
              "shares")
names(df1) <- newnames
df1 <-
  df1 %>% 
  mutate(date = as.Date(date, format = "%m/%d/%y")) %>% 
  mutate(image = factor(gsub("\\s-.*", "", ad)),
         text = factor(gsub(".*-\\s", "", ad))) %>% 
  mutate(text = gsub("Social norms", "SocialNorms", text)) %>% 
  mutate(text = factor(text)) %>% 
  mutate(image = relevel(image, ref = "Computer"),
         text = relevel(text, ref = "Incentive"))
```

Column name mapping.

```{r}
data.frame(old = c(oldnames, NA, NA), new = names(df1)) %>% kable
```

Summarize.

```{r}
df1 %>% 
  group_by(image, text) %>% 
  summarize(nDays = n(), minDate = min(date), maxDate = max(date)) %>% 
  kable
```


## Survey data

Inclusion criteria

* Respondents who consented
* Eligible, ineligible, or missing eligibility indicator

Cleaning

* Parse out `fba` into 2 separate variables for `image` and `text`
* Assign indicator for survey completion, `indSurveyComplete`
* Score the DSI-SS inventory
  * See [Joiner 2002](http://www.sciencedirect.com/science/article/pii/S0005796701000171)
  * *Scores on each item range from 0 to 3 and, for the inventory, from 0 to 12, with higher scores reflecting greater severity of suicidal ideation.*

```{r}
df2 <-
  "C:/Users/chanb/Box Sync/Facebook pilot - Statisticians/REDCap dataset.csv" %>% 
  read.csv(stringsAsFactors = FALSE) %>% 
  filter(consent == 1) %>% 
  mutate(image = 
           substr(fba, 1, 1) %>%
           factor(levels = c("c", "f", "v"),
                  labels = c("Computer", "Family", "Veteran")),
         text = 
           substr(fba, 2, 4) %>% 
           factor(levels = c("inc", "alt", "emp", "sha", "soc"),
                  labels = c("Incentive", "Altruism", "Empowerment", "Sharing", "SocialNorms"))) %>% 
  mutate(indSurveyComplete = time_completed_questions != "") %>%
  mutate(dsiss = dsiss_thoughts + dsiss_plans + dsiss_control + dsiss_impulses)
df2 %>% 
  group_by(image, text) %>% 
  summarize(n = n()) %>% 
  kable
df2 %>% 
  group_by(consent, eligible, consent_and_eligibility_complete, indSurveyComplete) %>% 
  summarize(n = n()) %>% 
  kable
```

### Use of VA health services

Questions

* Only makes sense for respondents who are eligible?
* Still showing `va_use_12mo == NA` for eligible, survey completers; what to do with these?

```{r}
df2 %>% 
  group_by(eligible, indSurveyComplete, va_ever_enrolled, va_use_12mo) %>% 
  summarize(n = n()) %>% 
  kable
```

### Presence of suicidality

Questions

* What DSI-SS cutoff should we use?

```{r}
df2 %>% 
  group_by(dsiss) %>% 
  summarize(n = n()) %>%
  mutate(freq = n / sum(n)) %>% 
  kable(digits = 3)
```
