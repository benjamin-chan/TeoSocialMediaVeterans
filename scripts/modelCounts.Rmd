# Model counts

* Use negative binomial model
* Factors
  * Ad `image`
  * Ad `text`
* Include full factorial interaction
* Use $\log(\text{impressions})$ or $\log(\text{reach})$ as an offset variable
* Calculate predicted counts per 1,000 impressions/reach

**Model**

$$
\begin{align*}
\log(y) = & \beta_0 + \\\\
          & \beta_1 x_\text{image: Family} + 
            \beta_2 x_\text{image: Veteran} + \\\\
          & \beta_3 x_\text{text: Altruism} + 
            \beta_4 x_\text{text: Empowerment} + 
            \beta_5 x_\text{text: Sharing} + 
            \beta_6 x_\text{text: Social norms} + \\\\
          & \gamma_1 x_\text{image: Family} x_\text{text: Altruism} + 
            \gamma_2 x_\text{image: Family} x_\text{text: Empowerment} +  \\\\
          & \gamma_3 x_\text{image: Family} x_\text{text: Sharing} + 
            \gamma_4 x_\text{image: Family} x_\text{text: Social norms} + \\\\
          & \gamma_5 x_\text{image: Veteran} x_\text{text: Altruism} + 
            \gamma_6 x_\text{image: Veteran} x_\text{text: Empowerment} +  \\\\
          & \gamma_7 x_\text{image: Veteran} x_\text{text: Sharing} + 
            \gamma_8 x_\text{image: Veteran} x_\text{text: Social norms} + \\\\
          & \log(x_\text{offset})
\end{align*}
$$


## Total clicks

Image files saved as [PNG](../figures/clicksTotal.png), [SVG](../figures/clicksTotal.svg)

![clicksTotal.png](../figures/clicksTotal.png)

```{r clicksTotal, fig.show = "hide"}
y <- "clicksTotal"
offset <- "impressions"
title <- "Number of ad clicks"
plotRates(y, offset, y, title)
M <- modelCounts(y, offset)
M$pred %>% kable(digits = 2)
M[["modelObject"]] %>% contrastTable %>% kable(digits = 3)
M[["modelObject"]] %>% contrastTable %>% .[["contrastImage"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapImage", y))
M[["modelObject"]] %>% contrastTable %>% .[["contrastText"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapText", y))
M[["modelObject"]] %>% contrastTable %>% .[["contrastInteraction"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapInteraction", y))
M$modelObject %>% summary
plotResid("resid", offset, sprintf("%sResid", y), title)
```


## Unique clicks

Image files saved as [PNG](../figures/clicksUnique.png), [SVG](../figures/clicksUnique.svg)

![clicksUnique.png](../figures/clicksUnique.png)

```{r clicksUnique, fig.show = "hide"}
y <- "clicksUnique"
offset <- "reach"
title <- "Number of unique ad clicks"
plotRates(y, offset, y, title)
M <- modelCounts(y, offset)
M$pred %>% kable(digits = 2)
M[["modelObject"]] %>% contrastTable %>% kable(digits = 3)
M[["modelObject"]] %>% contrastTable %>% .[["contrastImage"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapImage", y))
M[["modelObject"]] %>% contrastTable %>% .[["contrastText"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapText", y))
M[["modelObject"]] %>% contrastTable %>% .[["contrastInteraction"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapInteraction", y))
M$modelObject %>% summary
plotResid("resid", offset, sprintf("%sResid", y), title)
```


## Total link clicks

Image files saved as [PNG](../figures/linkClicksTotal.png), [SVG](../figures/linkClicksTotal.svg)

![linkClicksTotal.png](../figures/linkClicksTotal.png)

```{r linkClicksTotal, fig.show = "hide"}
y <- "linkClicksTotal"
offset <- "impressions"
title <- "Number of total link clicks"
plotRates(y, offset, y, title)
M <- modelCounts(y, offset)
M$pred %>% kable(digits = 2)
M[["modelObject"]] %>% contrastTable %>% kable(digits = 3)
M[["modelObject"]] %>% contrastTable %>% .[["contrastImage"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapImage", y))
M[["modelObject"]] %>% contrastTable %>% .[["contrastText"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapText", y))
M[["modelObject"]] %>% contrastTable %>% .[["contrastInteraction"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapInteraction", y))
M$modelObject %>% summary
plotResid("resid", offset, sprintf("%sResid", y), title)
```


## Unique link clicks

Image files saved as [PNG](../figures/linkClicksUnique.png), [SVG](../figures/linkClicksUnique.svg)

![linkClicksUnique.png](../figures/linkClicksUnique.png)

```{r linkClicksUnique, fig.show = "hide"}
y <- "linkClicksUnique"
offset <- "reach"
title <- "Number of unique link clicks"
plotRates(y, offset, y, title)
M <- modelCounts(y, offset)
M$pred %>% kable(digits = 2)
M[["modelObject"]] %>% contrastTable %>% kable(digits = 3)
M[["modelObject"]] %>% contrastTable %>% .[["contrastImage"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapImage", y))
M[["modelObject"]] %>% contrastTable %>% .[["contrastText"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapText", y))
M[["modelObject"]] %>% contrastTable %>% .[["contrastInteraction"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapInteraction", y))
M$modelObject %>% summary
plotResid("resid", offset, sprintf("%sResid", y), title)
```


## Reactions

Image files saved as [PNG](../figures/reactions.png), [SVG](../figures/reactions.svg)

![reactions.png](../figures/reactions.png)

```{r reactions, fig.show = "hide"}
y <- "reactions"
offset <- "impressions"
title <- "Number of reactions"
plotRates(y, offset, y, title)
M <- modelCounts(y, offset)
M$pred %>% kable(digits = 2)
M[["modelObject"]] %>% contrastTable %>% kable(digits = 3)
M[["modelObject"]] %>% contrastTable %>% .[["contrastImage"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapImage", y))
M[["modelObject"]] %>% contrastTable %>% .[["contrastText"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapText", y))
M[["modelObject"]] %>% contrastTable %>% .[["contrastInteraction"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapInteraction", y))
M$modelObject %>% summary
plotResid("resid", offset, sprintf("%sResid", y), title)
```


## Comments

Image files saved as [PNG](../figures/comments.png), [SVG](../figures/comments.svg)

![comments.png](../figures/comments.png)

```{r comments, fig.show = "hide"}
y <- "comments"
offset <- "impressions"
title <- "Number of comments"
plotRates(y, offset, y, title)
M <- modelCounts(y, offset)
M$pred %>% kable(digits = 2)
M[["modelObject"]] %>% contrastTable %>% kable(digits = 3)
M[["modelObject"]] %>% contrastTable %>% .[["contrastImage"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapImage", y))
M[["modelObject"]] %>% contrastTable %>% .[["contrastText"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapText", y))
M[["modelObject"]] %>% contrastTable %>% .[["contrastInteraction"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapInteraction", y))
M$modelObject %>% summary
plotResid("resid", offset, sprintf("%sResid", y), title)
```


## Shares

Image files saved as [PNG](../figures/shares.png), [SVG](../figures/shares.svg)

![shares.png](../figures/shares.png)

```{r shares, fig.show = "hide"}
y <- "shares"
offset <- "impressions"
title <- "Number of shares"
plotRates(y, offset, y, title)
M <- modelCounts(y, offset)
M$pred %>% kable(digits = 2)
M[["modelObject"]] %>% contrastTable %>% kable(digits = 3)
M[["modelObject"]] %>% contrastTable %>% .[["contrastImage"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapImage", y))
M[["modelObject"]] %>% contrastTable %>% .[["contrastText"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapText", y))
M[["modelObject"]] %>% contrastTable %>% .[["contrastInteraction"]] %>% contrastHeatmap(sprintf("%sContrastHeatmapInteraction", y))
M$modelObject %>% summary
plotResid("resid", offset, sprintf("%sResid", y), title)
```
