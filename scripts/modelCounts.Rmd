# Model counts

Use negative binomial model.


## Total clicks

```{r}
M <-
  df %>% 
  glm.nb(clicksTotal ~ adImage + adText + adImage * adText + offset(log(impressions)), 
         data = .)
tidy(M) %>% kable(digits = 3)
summary(M)
anova(M)
```

Image files saved as [PNG](../figures/residClicksTotal.png), [SVG](../figures/residClicksTotal.svg)

![residClicksTotal.png](../figures/residClicksTotal.png)

```{r residClicksTotal, fig.show = "hide"}
df <-
  df %>% 
  mutate(pred = predict(M, type = "response"),
         resid = resid(M, type = "response"))
G <- plotResid("resid", "Number of ad clicks")
```

Predicted values for 1,000 impressions

```{r}
expand.grid(adImage = levels(df$adImage), 
              adText = levels(df$adText), 
              impressions = 1000) %>% 
  mutate(pred = predict(M, newdata = ., type = "response"),
         linPred = predict(M, newdata = ., type = "link", se.fit = TRUE)[["fit"]],
         seLinPred = predict(M, newdata = ., type = "link", se.fit = TRUE)[["se.fit"]]) %>% 
  mutate(predLower = exp(linPred + qnorm(0.025) * seLinPred),
         predUpper = exp(linPred + qnorm(0.975) * seLinPred)) %>% 
  select(-c(linPred, seLinPred)) %>% 
  arrange(-pred) %>% 
  kable(digits = 1)
```
